# JMeter 테스트 보고서: Lua Script 기반 재고 예약 시스템 검증 (20240830_Concurrency_RedisReservation_v1)

## 1. 테스트 목적

Lua Script를 사용하면서 재고 관리 방식을 직접 차감/복원에서 예약 시스템으로 변경한 새로운 동시성 제어 메커니즘의 성능 및 효율성 검증

## 2. 테스트 환경

- 테스트 도구: Apache JMeter
- 대상 시스템: 주문 처리 API
- 총 요청 수: 2,000
- 동시 사용자 수: 1,000

## 3. 테스트 시나리오

1. `/api/v1/orders/prepare` 엔드포인트 호출 (GET)
2. `/api/v1/orders/create/{orderId}` 엔드포인트 호출 (POST)

## 4. 테스트 결과 요약

### 4.1 전체 성능 지표

- 총 샘플 수: 2,000
- 총 에러 수: 16 (0.8%)
- 평균 응답 시간: 2,288 ms
- 중간값 응답 시간: 1,564 ms
- 90번째 백분위 응답 시간: 5,030 ms
- 95번째 백분위 응답 시간: 5,917 ms
- 99번째 백분위 응답 시간: 8,035 ms
- 최소 응답 시간: 2 ms
- 최대 응답 시간: 8,762 ms
- 처리량: 약 140.5 requests/second

### 4.2 엔드포인트별 성능

#### 4.2.1 /api/v1/orders/prepare (GET)

- 샘플 수: 1,000
- 평균 응답 시간: 3,701 ms
- 에러율: 0.8%

#### 4.2.2 /api/v1/orders/create/{orderId} (POST)

- 샘플 수: 1,000
- 평균 응답 시간: 876 ms
- 에러율: 0.8%

## 5. 이전 버전(직접 차감/복원) 대비 변화 분석

1. **에러율 변화**:

   - 이전 버전: 0% → 재고 예약 시스템: 0.8%
   - 약간의 에러 발생, 하지만 여전히 낮은 수준 유지

2. **응답 시간 증가**:

   - `prepare` 엔드포인트: 455 ms → 3,701 ms (714% 증가)
   - `create` 엔드포인트: 63 ms → 876 ms (1,290% 증가)
   - 재고 예약 로직 추가로 인한 처리 시간 증가

3. **처리량 감소**:

   - 이전 버전: 434.8 req/s → 재고 예약 시스템: 140.5 req/s
   - 약 67.7% 처리량 감소

4. **일관성 변화**:

   - 응답 시간의 편차가 증가
   - 재고 예약 과정에서 추가적인 검증 단계로 인한 것으로 추정

5. **자원 효율성**:

   - 재고 예약을 위한 추가적인 Redis 연산 발생
   - 전체적인 자원 사용량 증가 예상

6. **확장성 변화**:
   - 처리량 감소와 응답 시간 증가로 인해 높은 부하 상황에서의 확장성에 영향을 미칠 수 있음

## 6. 결론 및 향후 계획

1. Lua Script 기반 재고 예약 시스템은 이전의 직접 차감/복원 방식에 비해 전반적인 성능 저하를 보임

2. 안정성 측면에서는 큰 문제가 없으나, 응답 시간과 처리량 면에서 개선이 필요한 상황

3. 추가 개선 및 검증 사항:
   - 재고 예약 로직 최적화 필요 (불필요한 연산 제거, 로직 단순화)
   - Redis 명령어 최적화 (다중 명령어를 단일 파이프라인으로 실행 등)
   - 재고 예약 시스템의 이점과 비용에 대한 재평가
   - 캐싱 전략 재검토 및 개선 (예약된 재고 정보의 효율적인 저장 및 조회 방법)
   - 높은 부하 상황에서의 성능 테스트 수행 (5,000 또는 10,000 동시 사용자)

결론: Lua Script 기반 재고 예약 시스템은 현재 상태에서 이전 직접 차감/복원 방식에 비해 성능이 저하되었습니다. 이는 재고 관리의 정확성과 일관성을 높이기 위한 추가적인 로직으로 인한 것으로 보입니다. 성능 개선을 위해 재고 예약 로직의 최적화가 필요하며, 특히 Redis 사용 방식과 재고 관리 알고리즘에 대한 면밀한 검토가 요구됩니다. 또한, 재고 예약 시스템의 장점(예: 정확한 재고 관리, 동시성 문제 해결)과 성능 저하의 트레이드오프를 고려하여 시스템 아키텍처를 재평가해야 합니다. 지속적인 모니터링과 최적화를 통해 재고 예약 시스템의 이점을 유지하면서 성능을 개선할 수 있는 방안을 모색해야 할 것입니다.
